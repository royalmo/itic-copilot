var svnjs={STATUS_CODES:{100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"None-Authoritive Information",204:"No Content",1223:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported",507:"Insufficient Storage"}};!function(){"use strict";if("undefined"==typeof JSON)throw"Browser not support JSON, 'JSON2.js' required in your project.";function i(t){return(t<10?"0":"")+t}var s=svnjs.STATUS_CODES,e=(svnjs.fmt=function(t){var e=arguments,n=e.length;if(n<=1)return String(t);for(var o=1,s=String(t).replace(/%[sdj]/g,function(t){if(n<o)return t;switch(t){case"%s":return String(e[o++]);case"%d":return Number(e[o++]);case"%j":return JSON.stringfy(e[o++]);default:return t}});o<n;o++)s+=" "+e[o];return s},function(){if("undefined"!=typeof XMLHttpRequest)return function(){return new XMLHttpRequest};if("undefined"!=typeof ActiveXObject)return function(){return new ActiveXObject("Microsoft.XMLHTTP")};throw"Browser not support XMLHTTP."}());svnjs.ajax=function(n){var o=e();if(o.onreadystatechange=function(){var t,e;4===o.readyState&&(t=o.status.toString(),e=o.responseText,o=null,"function"==typeof n.done&&n.done(t,s[t],e))},o.open(n.type.toUpperCase(),n.url,!0),n.headers)for(var t in n.headers)o.setRequestHeader(t,n.headers[t]);o.send(n.data)};svnjs.now=function(){var t=new Date,e=t.getFullYear(),n=i(t.getMonth()+1),o=i(t.getDate()),s=i(t.getHours()),r=i(t.getMinutes()),t=i(t.getSeconds());return svnjs.fmt("%s-%s-%s %s:%s:%s",e,n,o,s,r,t)},svnjs.log={ok:function(){},err:function(){}},"undefined"!==console&&"function"==typeof console.log&&(svnjs.log.ok=function(){var t=svnjs.fmt.apply(null,arguments);console.log("[OK]%s %s",svnjs.now(),t)},svnjs.log.err=function(){var t=svnjs.fmt.apply(null,arguments);console.log("[ERR]%s %s",svnjs.now(),t)}),svnjs.uuid=function(){for(var t=[],e=[8,4,4,4,12],n=0;n<5;n++){for(var o=e[n],s=[],r=0;r<o;r++)s.push("0123456789abcdefghijklmnopqrstuvwxyz"[36*Math.random()|0]);t.push(s.join(""))}return t.join("-")},"undefined"==typeof btoa&&svnjs.log.err("Base64 to ASC not support, you need to require a lib, ","and override svnjs.encrypt method."),svnjs.encrypt=function(t,e){t=t+":"+e;return"undefined"!=typeof btoa?"Basic "+btoa(t):t}}(),function(){"use strict";svnjs.fmt;var p=svnjs.log,c=svnjs.ajax,i=svnjs.uuid,a={activity:/<D:activity-collection-set><D:href>([^<]+)<\/D:href>/,checked_in:/:checked-in><D:href>([^<]+)<\/D:href>/,checked_out:/<\w+>Checked-out resource (\S+) has been created/,version_ctrl_conf:/version-controlled-configuration><D:href>([^<]+)<\/D:href>/,baseline_collection:/:baseline-collection><D:href>([^<]+)<\/D/,baseline_rel_path:/:baseline-relative-path>([^<]+)<\//};svnjs.WebDav=function(t,e){this._auth=t,this._base=e,this.activity=null},svnjs.WebDav.prototype.options=function(o,s){var r=this,t={headers:{"Content-type":"text/xml;charset=utf-8"},url:this._base,type:"OPTIONS",data:'<?xml version="1.0" encoding="utf-8"?><D:options xmlns:D="DAV:"><D:activity-collection-set/></D:options>',done:function(t,e,n){"200"===t?(p.ok("OPTIONS"),r.activity=n.match(a.activity)+i(),p.ok("Activity path is: ",r.activity),o&&o(t,e,text)):(p.err("OPTIONS: %s %s",t,e),s&&s())}};c(t)},svnjs.WebDav.prototype.propfind=function(o,s,t){var r=this;c({type:"PROPPATCH",url:o,headers:{Depth:0,"Content-type":"text/xml;charset=utf-8"},data:t,done:function(t,e,n){p.ok("PROPPATCH"),p.ok("    path: ",o),p.ok("    stat: ",e),"207"===t&&r._parseResponse(n),s(t,e,n)}})},svnjs.WebDav.prototype.mkactivity=function(o,s){var r=this,t={type:"MKACTIVITY",url:r.activity,headers:{Authorization:auth},done:function(t,e,n){"201"===t?(p.ok("MKACTIVITY: %s %s",t,e),p.ok("    Activity:",r.activity),o&&o(t,e,n)):(p.err("MKACTIVITY: %s %s",t,e),s&&s())}};c(t)},svnjs.WebDav.prototype.checkout=function(o,s,t){var r=this,e={type:"CHECKOUT",url:o,data:['<?xml version="1.0" encoding="utf-8"?>','<D:checkout xmlns:D="DAV:">',"<D:activity-set><D:href>",this.activity,"</D:href>","</D:activity-set><D:apply-to-version/></D:checkout>"].join(""),done:function(t,e,n){"201"===t?(p.ok("CHECKOUT: %s %s",t,e),p.ok("    path: %s",o),r._parseResponse(n),s&&s(t,e,n)):(p.err("CHECKOUT: %s %s",t,e),r.removeActivity())}};c(e)},svnjs.WebDav.prototype.proppatch=function(t,e,o,s){e=this._getPropPatchXML(e.set,e.del);var r=this,t={type:"PROPPATCH",url:t,headers:{"Content-type":"text/xml;charset=utf-8",Authorization:this.auth},data:['<?xml version="1.0" encoding="utf-8" ?>','<D:propertyupdate xmlns:D="DAV:"',' xmlns:V="http://subversion.tigris.org/xmlns/dav/"',' xmlns:C="http://subversion.tigris.org/xmlns/custom/"',' xmlns:S="http://subversion.tigris.org/xmlns/svn/">',e,"</D:propertyupdate>"].join(""),done:function(t,e,n){"207"===t?(p.ok("PROPPATCH: %s %s",t,e),o&&o(t,e,n)):(p.err("PROPPATCH [%s] %s",t,e),r.removeActivity(),s&&s())}};c(t)},svnjs.WebDav.prototype.put=function(t,e,n,o){var s=this.checked_out,r=-1!==s.indexOf(t)?s:s+"/"+t,i=this,s={type:"PUT",url:r,headers:{"Content-type":"text/plain",Authorization:this.auth},data:e,done:function(t,e,n){200<=t&&t<300?(p.ok("PUT [%s] %s",t,e),p.ok("    path: ",r)):(p.err("PUT [%s] %s",t,e),p.err("   path: ",r),i.removeActivity(),o&&o())}};c(s)},svnjs.WebDav.prototype.delete=function(t,o,s){var e=this.checked_out,r="string"==typeof t?e+"/"+t:t.join(""),e={type:"DELETE",url:r,headers:{Authorization:this.auth},done:function(t,e,n){200<=t&&t<300?(p.ok("DELETE [%s] %s",t,e),p.ok("    path: ",r),o&&o(t,e,n)):(p.err("DELETE [%s] %s",t,e),p.err("   path: ",r),s&&s())}};c(e)},svnjs.WebDav.prototype.move=function(o,s,r,i){var a=this,t={type:"MOVE",url:o,headers:{Destination:s,Overwrite:"F",Authorization:this.auth},done:function(t,e,n){200<=t&&t<300?(p.ok("MOVE [%s] %s",t,e),p.ok("    path: ",o),p.ok("    dest: ",s),r&&r(t,e,n)):(p.err("MOVE [%s] %s",t,e),p.err("    path: ",o),p.err("    dest: ",s),i&&i(),a.removeActivity())}};c(t)},svnjs.WebDav.prototype.copy=function(o,s,r,i){var a=this,t={type:"COPY",url:o,headers:{Destination:s,Overwrite:"F",Authorization:this.auth},done:function(t,e,n){200<=t&&t<300?(p.ok("MOVE [%s] %s",t,e),p.ok("    path: ",o),p.ok("    dest: ",s),r&&r(t,e,n)):(p.err("MOVE [%s] %s",t,e),p.err("    path: ",o),p.err("    dest: ",s),i&&i(),a.removeActivity())}};c(t)},svnjs.WebDav.prototype.mkcol=function(o,s,r){var i=this,t={type:"MKCOL",url:o,headers:{Authorization:this.auth},done:function(t,e,n){200<=t&&t<300?(p.ok("MKCOL [%s] %s",t,e),p.ok("    path: ",o),s&&s(t,e,n)):(p.err("MKCOL [%s] %s",t,e),p.err("   path: ",o),i.removeActivity(),r&&r())}};c(t)},svnjs.WebDav.prototype.lock=function(t,e,n){},svnjs.WebDav.prototype.unlock=function(t,e,n){},svnjs.WebDav.prototype.merge=function(o,s){var r=this.activity,i=this,t={type:"MERGE",url:r,headers:{"X-SVN-Options":"release-locks","Content-type":"text/xml;charset=utf-8",Authorization:this.auth},data:['<?xml version="1.0" encoding="utf-8"?>','<D:merge xmlns:D="DAV:"><D:source>',"<D:href>",r,"</D:href>","</D:source><D:no-auto-merge/><D:no-checkout/>","<D:prop><D:checked-in/><D:version-name/>","<D:resourcetype/><D:creationdate/>","<D:creator-displayname/></D:prop></D:merge>"].join(""),done:function(t,e,n){"200"===t?(p.ok("MERGE [%s] %s",t,e),p.ok("    path: ",r),i.removeActivity(o)):(p.err("MERGE [%s] %s",t,e),p.err("   path: ",r),i.removeActivity(),s&&s(t,e,n))}};c(t)},svnjs.WebDav.prototype._parseResponse=function(t){for(var e in a){var n=t.match(a[e]);n&&(this[e]=n[1])}},svnjs.WebDav.prototype.removeActivity=function(t){this.delete(this.activity,function(){t&&t.apply(null,arguments)},function(){p.err("%s: remove activity fail",this.activity)})},svnjs.WebDav.prototype._getPropPatchXML=function(t,e){var n=[];if(t){for(var o in n.push("<D:set>"),t)n.push("<D:prop>"),n.push("<S:"+o+" >"),n.push(t[o]),n.push("</S:"+o+">"),n.push("</D:prop>");n.push("</D:set>")}if(e){n.push("<D:remove>");for(var s=0;o=e[s];s++)n.push("<D:prop><S:"+o+" /></D:prop>");n.push("</D:remove>")}return n.join("")}}(),function(){"use strict";var e=svnjs.log;svnjs.Client=function(t,e,n){if(3!==arguments.length)throw new Error("new svnjs.Client: args required 3");t=svnjs.encrypt(t,e);this._webdav=new svnjs.WebDav(t,n),this._baseurl=n,this._handlers=[],this._tocancel=!1},svnjs.Client.prototype.cancel=function(){this._handlers.length=0,this._tocancel=!0},svnjs.Client.prototype.add=function(t,e){this._handlers.push({method:"put",params:[t,e]})},svnjs.Client.prototype.del=function(t){this._handlers.push({method:"delete",params:[t]})},svnjs.Client.prototype.mkdir=function(t){this._handlers.push({method:"mkcol",params:[t]})},svnjs.Client.prototype.propset=function(t,e){this._handlers.push({method:"proppatch",params:[t,{set:e}]})},svnjs.Client.prototype.propdel=function(t,e){this._handlers.push({method:"proppatch",params:[t,{del:e}]})},svnjs.Client.prototype.commit=function(t){this._message=t,this._doneHandler=null,this._failHandler=null;var e=this,n=this._webdav;return n.options(function(){n.propfind(e._baseurl,function(t){"207"===t?e._makeActivity():e._failHandler&&e.failHandler()})}),{done:function(t){return e._doneHandler=t,this},fail:function(t){return e._failHandler=t,this}}},svnjs.Client.prototype.copy=function(){},svnjs.Client.prototype.move=function(){},svnjs.Client.prototype.lock=function(){},svnjs.Client.prototype.unlock=function(){},svnjs.Client._makeActivity=function(){var t=this,e=this._webdav;function n(){t._patchlog()}function o(){"function"==typeof t._failHandler&&t._failHandler()}e.mkactivity(function(){e.checkout(dav.version_ctrl_conf,n,o)})},svnjs.Client.prototype._patchlog=function(){var t=this,e=this._webdav,n={set:{log:t._message}};e.proppatch(e.checked_out,n,function(){t._processAll()},function(){t._failHandler&&t._failHandler()})},svnjs.Client.prototype._processAll=function(){var t,e,n,o,s;function r(){t._failHandler&&t._failHandler()}this._tocancel?this._tocancel=!1:(e=(t=this)._webdav,n=this._handler.shift(),o=n.method,(s=n.params).push(function(){t._handlers.length?t._processAll():t._merge()}),s.push(r),e.checkout(this._getCheckoutUrl(o,s[0]),function(){if("copy"===o)return t._prepareCopy(s);"proppatch"===o?s[0]=e.checked_out:"mkcol"===o&&(s[0]=e.checked_out+"/"+s[0]),e[o].apply(e,s)},r))},svnjs.Client.prototype._getCheckoutUrl=function(t,e){var n=this._webdav.checked_in;return"./"===e&&"copy"===t||("proppatch"===t||-1<e.indexOf("/"))&&(n+="/"+e),n},svnjs.Client.prototype._prepareCopy=function(s){var r=this._webdav,i=s[1];function t(t,e,n){var o=s[0],o=r.checked_out+"/"+("./"===o?"":o);i=r.baseline_collection+r.baseline_rel_path+"/"+i,r.copy(i,o,s[2])}r.propfind(i,function(){r.propfind(r.version_ctrl_conf,t)})},svnjs.Client.prototype._merge=function(){var t=this;t._webdav.merge(function(){e.ok(t._message," done!"),t._doneHandler&&t.doneHandler()},function(){t._failHandler&&t._failHandler()})},svnjs.Client.prototype.rm=svnjs.Client.prototype.remove=svnjs.Client.prototype.delete=svnjs.Client.prototype.del,svnjs.Client.prototype.mv=svnjs.Client.prototype.rename=svnjs.Client.prototype.ren=svnjs.Client.prototype.move,svnjs.Client.prototype.cp=svnjs.Client.prototype.copy,svnjs.Client.prototype.pset=svnjs.Client.prototype.ps=svnjs.Client.prototype.propset,svnjs.Client.prototype.pdel=svnjs.Client.prototype.pd=svnjs.Client.prototype.propdel}();